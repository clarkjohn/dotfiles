##### Terminal / Clipboard #####
# Better colors in modern terminals (iTerm2)
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",*:Tc"

# Integrate with system clipboard (macOS)
set -g set-clipboard on

##### Prefix #####
unbind C-b
set -g prefix C-a
bind C-a send-prefix

##### Basics #####
set -g mouse on
setw -g mode-keys vi

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Escape key timing (safer for SSH/meta keys than 0)
set -sg escape-time 10

# More scrollback
set -g history-limit 100000

##### Splits / Windows #####
# Split panes using | and - using current path
bind | split-window -h -c "#{pane_current_path}"
bind-key - split-window -v -c "#{pane_current_path}"

# New window: fast default + optional named window (both in current path)
bind c new-window -c "#{pane_current_path}"
bind C command-prompt -p "Name of new window: " "new-window -n '%%' -c '#{pane_current_path}'"

##### Navigation #####
# Shift + arrow without prefix to switch windows (depends on terminal sending these keys)
bind -n S-Left previous-window
bind -n S-Right next-window

##### Pane resizing (Prefix + arrows) #####
bind -r Left  resize-pane -L 2
bind -r Right resize-pane -R 2
bind -r Up    resize-pane -U 2
bind -r Down  resize-pane -D 2

##### Copy / Paste (macOS) #####
# Start selection with v (like vim)
bind-key -T copy-mode-vi v send -X begin-selection

# Copy selection with y -> macOS clipboard, then exit copy-mode
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

# Paste macOS clipboard into tmux buffer (prefix + p)
bind p run-shell 'pbpaste | tmux load-buffer - && tmux paste-buffer'

##### Reload #####
bind r source-file ~/.tmux.conf \; display-message "Reloaded ~/.tmux.conf"

##### Status / Theme (Solarized-ish) #####
set -g status-interval 5
set -g status-style "bg=colour235,fg=colour136"  # base02 / yellow-ish

# window title formats
setw -g window-status-current-format "#[reverse] #I:#W "
setw -g window-status-format " #I:#W "

# pane number display
set -g display-panes-active-colour colour33   # blue
set -g display-panes-colour colour166         # orange

# clock
setw -g clock-mode-colour colour64            # green

# bell
setw -g window-status-bell-style fg=colour235,bg=colour160  # base02/red

##### TPM + Persist / Restore #####
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'
set -g @resurrect-processes 'ssh vim nvim zsh bash fish node python3 htop tail'

run '~/.tmux/plugins/tpm/tpm'